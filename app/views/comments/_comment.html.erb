<turbo-frame id="<%= dom_id(comment) %>">
    <div class="comment-box" data-controller="comment-toggle">
        <div class="comment-user-date">
            <strong><%= comment.user.username %></strong>
            <small><%= time_ago_in_words(comment.created_at) %> ago</small>
        </div>

        <div class="comment-body">
            <p><%= simple_format(comment.body) %></p>
        </div>

        <div class="comment-actions">
            <%= render "likes/like_button", likeable: comment %>

            <%= link_to "Reply", "#", 
                        class: "reply-button",
                        data: { action: "click->comment-toggle#toggleReply" } %>
            
            <% if comment.comments.any? %>
                <%= link_to "See replies (#{comment.comments.count})", "#",
                            class: "reveal-replies-button",
                            data: { action: "click->comment-toggle#toggleReplies" } %>
            <% end %>

            <% if comment.user == current_user %>
                <%= link_to "Delete",
                    polymorphic_path([comment.commentable, comment]),
                    data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                    class: "text-red-500 text-sm" %>
            <% end %>
        </div>

        <div data-comment-toggle-target="replyForm" class="hidden">
            <%= render "comments/form", commentable: comment, comment: Comment.new %>
        </div>
        
        <% if comment.comments.any? %>
            <div data-comment-toggle-target="replies" class="hidden pl-4 mt-2 border-l">
                <div id="comments_for_<%= dom_id(comment) %>">
                    <%= render comment.comments %>
                </div>
            </div>
        <% end %>

    </div>
</turbo-frame>